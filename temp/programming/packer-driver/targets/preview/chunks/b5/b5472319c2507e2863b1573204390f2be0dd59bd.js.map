{"version":3,"sources":["file:///Users/geminy/Desktop/mianshi2/assets/script/ArtButton.ts"],"names":["_decorator","Node","Sprite","Color","Component","director","Scheduler","tween","Vec3","ccclass","property","ArtButton","anim_start","anim_loop","anim_press","anim_hold_loop","anim_release","start","node","on","EventType","TOUCH_START","onTouchStart","TOUCH_END","onTouchEnd","resetBtn","onResetBtnClick","scale","ZERO","setTimeOnce","animStart","reset","stop","cancelAllTimer","to","easing","union","repeatForever","eulerAngles","start_scale","scale1","scale2","eulerAngles1","eulerAngles2","eulerAngles3","parallel","event","sprite","getComponent","color","time_scale","press_time","press_effect","multiplyScalar","anim_hold_loop_start","obj","callback","delay","scheduler","getScheduler","enableForTarget","paused","isTargetPaused","schedule","unscheduleAllForTarget"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, UITransform, Label, Node, Sprite } from 'cc';\r\nimport { instantiate } from 'cc';\r\nimport { Color } from 'cc';\r\nimport { Component } from 'cc';\r\nimport { director } from 'cc';\r\nimport { Scheduler } from 'cc';\r\nimport { tween } from 'cc';\r\nimport { Vec3 } from 'cc';\r\nimport { EventTouch } from 'cc';\r\n\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ArtButton')\r\nexport class ArtButton extends Component {\r\n    @property(Node) resetBtn: Node;\r\n\r\n\r\n    start () {\r\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this, true);\r\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n\r\n        this.resetBtn?.on(Node.EventType.TOUCH_END, this.onResetBtnClick, this);\r\n\r\n        this.node.scale = Vec3.ZERO\r\n        this.setTimeOnce(this, () => {\r\n            this.animStart()\r\n        }, 2)\r\n    }\r\n\r\n\r\n    onResetBtnClick () {\r\n        this.animStart()\r\n    }\r\n\r\n    private anim_start\r\n    private anim_loop\r\n    private anim_press\r\n    private anim_hold_loop\r\n    private anim_release\r\n\r\n    reset () {\r\n        this.anim_start?.stop();\r\n        this.anim_loop?.stop();\r\n        this.anim_press?.stop();\r\n        this.anim_hold_loop?.stop();\r\n        this.anim_release?.stop();\r\n        this.cancelAllTimer(this)\r\n    }\r\n\r\n    animStart () {\r\n        this.reset()\r\n        let node = this.node\r\n\r\n        if (!this.anim_loop) {\r\n            this.anim_loop = tween(node)\r\n                .to(0.4, { scale: new Vec3(1.05, 0.96, 1) }, { easing: \"cubicOut\" })\r\n                .to(0.3, { scale: new Vec3(1, 1, 1) }, { easing: \"cubicOut\" })\r\n                .union()\r\n                .repeatForever()\r\n        }\r\n\r\n\r\n        node.eulerAngles = new Vec3(0, 0, -7)\r\n        node.scale = Vec3.ZERO\r\n\r\n        let start_scale = 0.6\r\n        let scale1 = new Vec3(1.2, 1, 1)\r\n        let scale2 = new Vec3(1, 1, 1)\r\n        let eulerAngles1 = new Vec3(0, 0, 7)\r\n        let eulerAngles2 = new Vec3(0, 0, -7)\r\n        let eulerAngles3 = new Vec3(0, 0, 0)\r\n        this.anim_start = tween(node).parallel(\r\n            tween()\r\n                .to(0.4 * start_scale, { scale: scale1 }, { easing: \"cubicOut\" })\r\n                .to(0.3 * start_scale, { scale: scale2 }, { easing: \"cubicOut\" }),\r\n            tween()\r\n                .to(0.28 * start_scale, { eulerAngles: eulerAngles1 }, { easing: \"cubicOut\" })\r\n                .to(0.28 * start_scale, { eulerAngles: eulerAngles2 }, { easing: \"cubicOut\" })\r\n                .to(0.14 * start_scale, { eulerAngles: eulerAngles3 }, { easing: \"cubicOut\" }),\r\n        )\r\n\r\n        this.setTimeOnce(this, () => {\r\n            this.anim_loop.start()\r\n        }, 0.7 * start_scale)\r\n\r\n        this.anim_start.start();\r\n    }\r\n\r\n\r\n    onTouchStart (event: EventTouch) {\r\n        this.reset()\r\n\r\n\r\n        let node = this.node\r\n        let sprite = node.getComponent(Sprite)\r\n        sprite.color = new Color(128, 128, 128)\r\n\r\n        let time_scale = 0.6\r\n\r\n        let press_time = 0.2\r\n        let press_effect = 0.85\r\n        let scale1 = new Vec3(1, 1, 1).multiplyScalar(press_effect)\r\n\r\n        if (!this.anim_press) {\r\n            this.anim_press = tween(node)\r\n                .to(press_time, { scale: scale1 }, { easing: \"cubicOut\" })\r\n        }\r\n\r\n\r\n        if (!this.anim_hold_loop) {\r\n            this.anim_hold_loop = tween(node)\r\n                .to(0.4, { scale: new Vec3(1.05, 0.96, 1).multiplyScalar(press_effect) }, { easing: \"cubicOut\" })\r\n                .to(0.3, { scale: new Vec3(1, 1, 1).multiplyScalar(press_effect) }, { easing: \"cubicOut\" })\r\n                .union()\r\n                .repeatForever()\r\n        }\r\n\r\n        this.anim_press.start()\r\n        this.setTimeOnce(this, () => {\r\n            this.anim_hold_loop.start()\r\n        }, press_time)\r\n    }\r\n\r\n    anim_hold_loop_start () {\r\n        this.anim_hold_loop?.start()\r\n    }\r\n\r\n    onTouchEnd (event: EventTouch) {\r\n        this.reset()\r\n\r\n        let node = this.node\r\n        let sprite = node.getComponent(Sprite)\r\n        sprite.color = new Color(255, 255, 255)\r\n\r\n        let press_time = 0.2\r\n        if (!this.anim_release) {\r\n            this.anim_release = tween(node)\r\n                .to(press_time, { scale: new Vec3(1, 1, 1) }, { easing: \"cubicOut\" })\r\n        }\r\n\r\n        this.anim_release.start()\r\n        this.setTimeOnce(this, () => {\r\n            this.anim_loop.start()\r\n        }, press_time)\r\n    }\r\n\r\n\r\n    setTimeOnce (obj: Object, callback: (dt: number) => void, delay: number) {\r\n        let scheduler = director.getScheduler();\r\n        Scheduler.enableForTarget(obj);\r\n        const paused = scheduler.isTargetPaused(obj);\r\n        scheduler.schedule(callback, obj, 0, 0, delay, paused);\r\n    }\r\n\r\n    cancelAllTimer (obj: Object) {\r\n        if (obj) {\r\n            let scheduler = director.getScheduler();\r\n            Scheduler.enableForTarget(obj);\r\n            scheduler.unscheduleAllForTarget(obj);\r\n        }\r\n    }\r\n}"]}